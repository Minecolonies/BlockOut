package com.minecolonies.blockout_test.command;

import com.minecolonies.blockout.BlockOut;
import com.minecolonies.blockout.binding.dependency.DependencyObjectHelper;
import com.minecolonies.blockout.element.root.RootGuiElement;
import com.minecolonies.blockout_test.context.BindingTestContext;
import net.minecraft.command.CommandBase;
import net.minecraft.command.ICommandSender;
import net.minecraft.entity.player.EntityPlayerMP;
import net.minecraft.server.MinecraftServer;
import net.minecraft.util.EnumFacing;
import net.minecraft.util.ResourceLocation;

public class CommandOpenTestGui extends CommandBase
{
    @Override
    public String getName()
    {
        return "bo_test";
    }

    @Override
    public String getUsage(final ICommandSender sender)
    {
        return "Opens the test gui";
    }

    @Override
    public void execute(final MinecraftServer server, final ICommandSender sender, final String[] args)
    {
        if (!(sender instanceof EntityPlayerMP))
        {
            return;
        }

        EntityPlayerMP playerMP = (EntityPlayerMP) sender;
        BlockOut.getBlockOut().getProxy().getGuiController().openUI(playerMP, iGuiKeyBuilder -> iGuiKeyBuilder
                                                                                                  .ofFile(new ResourceLocation("blockout_test:gui/binding_test.json"))
                                                                                                  .usingData(iBlockOutGuiConstructionDataBuilder -> iBlockOutGuiConstructionDataBuilder
                                                                                                                                                      .withControl("root",
                                                                                                                                                        RootGuiElement.RootGuiConstructionDataBuilder.class)
                                                                                                                                                      .withDependentDataContext(
                                                                                                                                                        DependencyObjectHelper.createFromValue(
                                                                                                                                                          new BindingTestContext(
                                                                                                                                                            "Hello!")))
                                                                                                                                                      .done())
                                                                                                  .withItemHandlerManager(manager -> {
                                                                                                      manager.withTileBasedProvider(new ResourceLocation("blockout:test_inventory"),
                                                                                                        0,
                                                                                                        60,
                                                                                                        4,
                                                                                                        113,
                                                                                                        EnumFacing.NORTH);
                                                                                                  })
                                                                                                  .forEntity(playerMP));
    }
}
