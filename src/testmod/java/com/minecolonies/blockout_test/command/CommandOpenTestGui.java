package com.minecolonies.blockout_test.command;

import com.google.common.collect.ImmutableList;
import com.minecolonies.blockout.BlockOut;
import com.minecolonies.blockout.binding.dependency.DependencyObjectHelper;
import com.minecolonies.blockout.builder.data.BlockOutGuiConstructionData;
import com.minecolonies.blockout.builder.data.builder.BlockOutGuiConstructionDataBuilder;
import com.minecolonies.blockout.element.advanced.List;
import com.minecolonies.blockout.element.root.RootGuiElement;
import com.minecolonies.blockout.element.simple.Button;
import com.minecolonies.blockout_test.context.BindingTestContext;
import com.minecolonies.blockout_test.context.SlotListBinding;
import com.minecolonies.blockout_test.tests.BlockOutUITestManager;
import com.minecolonies.blockout_test.tests.IBlockOutUITest;
import net.minecraft.command.CommandBase;
import net.minecraft.command.ICommandSender;
import net.minecraft.entity.player.EntityPlayerMP;
import net.minecraft.server.MinecraftServer;
import net.minecraft.util.EnumFacing;
import net.minecraft.util.ResourceLocation;

public class CommandOpenTestGui extends CommandBase
{
    @Override
    public String getName()
    {
        return "bo_test";
    }

    @Override
    public String getUsage(final ICommandSender sender)
    {
        return "Opens the test gui";
    }

    @Override
    public void execute(final MinecraftServer server, final ICommandSender sender, final String[] args)
    {
        if (!(sender instanceof EntityPlayerMP))
        {
            return;
        }

        EntityPlayerMP playerMP = (EntityPlayerMP) sender;
        BlockOut.getBlockOut().getProxy().getGuiController().openUI(playerMP, iGuiKeyBuilder -> iGuiKeyBuilder
                                                                                                  .ofFile(new ResourceLocation("blockout_test:gui/global_test_ui.json"))
                                                                                                  .usingData(iBlockOutGuiConstructionDataBuilder -> iBlockOutGuiConstructionDataBuilder
                                                                                                                                                      .withControl("tests",
                                                                                                                                                        List.ListConstructionDataBuilder.class,
                                                                                                                                                        listConstructionDataBuilder ->
                                                                                                                                                          listConstructionDataBuilder
                                                                                                                                                            .withDataContext(
                                                                                                                                                              BlockOutUITestManager.getInstance()
                                                                                                                                                                .getTestList())
                                                                                                                                                            .withTemplateConstructionData(
                                                                                                                                                              new BlockOutGuiConstructionDataBuilder()
                                                                                                                                                                .withControl(
                                                                                                                                                                  "test_button",
                                                                                                                                                                  Button.ButtonConstructionDataBuilder.class,
                                                                                                                                                                  buttonConstructionDataBuilder ->
                                                                                                                                                                    buttonConstructionDataBuilder
                                                                                                                                                                      .withClickedEventHandler(
                                                                                                                                                                        (button, eventArgs) -> {
                                                                                                                                                                            final Object
                                                                                                                                                                              buttonContext =
                                                                                                                                                                              button
                                                                                                                                                                                .getDataContext();
                                                                                                                                                                            if (buttonContext instanceof IBlockOutUITest)
                                                                                                                                                                            {
                                                                                                                                                                                IBlockOutUITest
                                                                                                                                                                                  iBlockOutUITest =
                                                                                                                                                                                  (IBlockOutUITest) buttonContext;
                                                                                                                                                                                iBlockOutUITest.onTestButtonClicked(playerMP, button, eventArgs);
                                                                                                                                                                            }
                                                                                                                                                                        }
                                                                                                                                                                      ))
                                                                                                                                                                .build()))
                                                                                                  )
                                                                                                  .withDefaultItemHandlerManager()
                                                                                                  .forEntity(playerMP));
    }
}
